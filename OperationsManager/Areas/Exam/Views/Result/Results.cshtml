@using OperationsManager.ExtendedHtmlHelpers
@model OperationsManager.Areas.Exam.Models.ResultVM

@{
    ViewBag.Title = "Results";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
}
@section StyleBlocks
{
    <link href="~/Content/printStyles.css" type="text/css" rel="stylesheet" />
}
@section PageScripts
{
    <script type="text/javascript">
        function printResult() {

            var mywindow = window.open('', 'PRINT', 'height=400,width=600');

            mywindow.document.write('<html><head><title></title>');
            //mywindow.document.write('<link href="~/Content/printStyles.css" type="text/css" rel="stylesheet" />');
            mywindow.document.write('<style>@@media print{.resultCard{page-break-after: always; margin-top: 300px;} .headerSummary{font-weight:bold;} .printInnerTable{border:1px solid black; text-align:left;}}</style>');
            mywindow.document.write('</head><body >');
            //mywindow.document.write('<h1>' + document.title + '</h1>');
            mywindow.document.write(document.getElementById("printSection").innerHTML);
            mywindow.document.write('</body></html>');

            mywindow.document.close(); // necessary for IE >= 10
            mywindow.focus(); // necessary for IE >= 10*/

            mywindow.print();
            mywindow.close();
            return true;
        }

        $(document).ready(function () {
            var currentDate = new Date();
            var strDate = currentDate.getDate() + "-" + (currentDate.getMonth()+1) + "-" + currentDate.getFullYear();
            $(".spnDate").html(strDate);
        });
    </script>
}
@using (Html.BeginForm())
{
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-color panel-primary">
                <div class="panel-heading">
                    <b>Result Cards</b>
                </div>
                <div class="panel-body">
                    @Html.AntiForgeryToken()
                    <fieldset>
                        <div class="col-lg-3">
                            @Html.OpMgrDropDownListFor(m => m.SelectedLocation, Model.LocationList, "Location", new { @class = "form-control requiredField reqSearch" })
                        </div>
                        <div class="col-lg-3">
                            @Html.OpMgrDropDownListFor(m => m.SelectedStandardSection, Model.StandardSectionList, "Standard & Section", new { @class = "form-control requiredField reqSearch" })
                        </div>
                        <div class="col-lg-3">
                            @Html.OpMgrDropDownListFor(m => m.SelectedResultType, Model.ResultTypes, "Exam Type", new { @class = "form-control requiredField reqSearch" })
                        </div>
                        <div class="col-lg-3">
                            @Html.OpMgrDropDownListFor(m => m.SelectedAcademicSession, Model.AcademicSessions, "Academic Session", new { @class = "form-control requiredField reqSearch" })
                        </div>
                        <div class="col-lg-3">
                            @Html.OpMgrSubmitButtonWithIcon("btnSearch", "Search", new { @class = "btn btn-primary btn-block" }, "fa fa-search")
                        </div>
                        <div class="col-lg-3">
                            @Html.OpMgrButtonWithIcon("btnSearch", "Print", new { @class = "btn btn-primary btn-block", onclick = "printResult();" }, "fa fa-print")
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="panel panel-color panel-primary">
                <div class="panel-heading">
                    <b>Student Results</b>
                </div>
                <div id="printSection">
                    <div class="panel-body printPanel">
                        @if (Model.ResultCards == null || Model.ResultCards.Count == 0)
                        {
                            <span class="danger" style="color:red">NO RESULTS IS FOUND FOR THIS SEARCH</span>
                        }
                        else
                        {
                            foreach (OpMgr.Common.DTOs.ResultCardDTO rcDTO in Model.ResultCards)
                            {
                                <table class="table table-bordered resultCard" style="width:100%">
                                    <tr>
                                        <td align="left" width="150px;" class="headerSummary">NAME &amp; REG. NO: </td>
                                        <td align="left">@rcDTO.StudentName &nbsp;(@rcDTO.StudentRegNo)</td>
                                        <td align="left" width="100px;" class="headerSummary">DATE: </td>
                                        <td align="left" width="100px;"><span class="spnDate"></span></td>
                                    </tr>
                                    <tr>
                                        <td align="left" width="100px;" class="headerSummary">CLASS &amp; SEC: </td>
                                        <td align="left">@rcDTO.ClassName &nbsp;(@rcDTO.SectionName) / @rcDTO.StudentRollNo</td>
                                        <td align="left" width="100px;" class="headerSummary">SESSION: </td>
                                        <td align="left" width="100px;">@rcDTO.SessionStart - @rcDTO.SessionEnd</td>
                                    </tr>
                                    @if (rcDTO.ResultRows != null && rcDTO.ResultRows.Count > 0)
                                    {
                                        <tr>
                                            <td colspan="4">
                                                <table style="width:100%">
                                                    <tr>
                                                        <td style="width:60%">
                                                            <table class="table table-bordered printInnerTable" style="width:100%;">
                                                                <thead>
                                                                    <tr>
                                                                        <th rowspan="2">Subject</th>
                                                                        @for (int h = 0; h < rcDTO.ResultRows[0].ResultColumns.Count; h++)
                                                                        {
                                                                            <th>@rcDTO.ResultRows[0].ResultColumns[h].ColumnName</th>
                                                                        }
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @for (int i = 0; i < rcDTO.ResultRows.Count; i++)
                                                                    {
                                                                        <tr>
                                                                            <td>@rcDTO.ResultRows[i].SubjectName</td>
                                                                            @for (int x = 0; x < rcDTO.ResultRows[i].ResultColumns.Count; x++)
                                                                            {
                                                                                <td>@rcDTO.ResultRows[i].ResultColumns[x].ColumnValue</td>
                                                                            }
                                                                        </tr>
                                                                    }
                                                                </tbody>
                                                            </table>
                                                        </td>
                                                        <td>

                                                        </td>
                                                    </tr>
                                                </table>  
                                            </td>
                                        </tr>
                                    }
                                    @if(rcDTO.GradeResultRows!=null && rcDTO.GradeResultRows.Count>0)
                                    {
                                        <tr>
                                            <td colspan="4">
                                                <table style="width:100%" class="table table-bordered printInnerTable">
                                                    @for(int i=0;i<rcDTO.GradeResultRows.Count;i++)
                                                    {
                                                        <tr>
                                                            <td style="width:30%">
                                                                @rcDTO.GradeResultRows[i].SubjectName
                                                            </td>
                                                            @for (int x = 0; x < rcDTO.GradeResultRows[i].ResultColumns.Count; x++)
                                                            {
                                                                if (rcDTO.GradeResultRows[i].ResultColumns[x].IsAllowedForGrade)
                                                                {
                                                                    <td>@rcDTO.GradeResultRows[i].ResultColumns[x].ColumnValue</td>
                                                                }
                                                            }
                                                            <td style="width:30%">
                                                                @if(i+1<rcDTO.GradeResultRows.Count)
                                                                {
                                                                    @rcDTO.GradeResultRows[i+1].SubjectName
                                                                }
                                                            </td>
                                                            @if(i+1<rcDTO.GradeResultRows.Count)
                                                            {
                                                                for (int x = 0; x < rcDTO.GradeResultRows[i + 1].ResultColumns.Count; x++)
                                                                {
                                                                    if (rcDTO.GradeResultRows[i + 1].ResultColumns[x].IsAllowedForGrade)
                                                                    {
                                                                        <td>@rcDTO.GradeResultRows[i + 1].ResultColumns[x].ColumnValue</td>
                                                                    }
                                                                }
                                                            }
                                                            else
                                                            {
                                                                for (int x = 0; x < rcDTO.GradeResultRows[i].ResultColumns.Count; x++)
                                                                {
                                                                    if (rcDTO.GradeResultRows[i].ResultColumns[x].IsAllowedForGrade)
                                                                    {
                                                                        <td></td>
                                                                    }
                                                                }
                                                            }
                                                        </tr>
                                                    }
                                                </table>
                                            </td>
                                        </tr>
                                    }
                                </table>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
}

